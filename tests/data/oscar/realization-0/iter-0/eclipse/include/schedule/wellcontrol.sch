UDQ
ASSIGN FUWATSRU 24000 /
ASSIGN FUWATINJ 24000 /
DEFINE FUWATINJ FUWATSRU + GWPR 'WIST'  /
DEFINE FUWAT1 GWPR 'WIST' < (28380 - 24000)  /
DEFINE FUWAT2 GWPR 'WIST' >= (28380 - 24000)  /
DEFINE FUWAT (FUWAT1)*FUWATINJ +(FUWAT2)*28380 /

DEFINE FUPWFR1 FWIR ==0 /
DEFINE FUPWFR2 FWIR > 0 /
DEFINE FUPWFR3 FWPR > FWIR /
DEFINE FUPWFR4 FWPR <= FWIR /
DEFINE FUPWFR  FUPWFR3*1 + FUPWFR4*(FUPWFR1*0+FUPWFR2*(FWPR/(FWIR+0.00000001))) / --Produced water fraction

-- Water production restricted by water injection
DEFINE FUWIR1 GWIR 'WIST' <  19000 /   -- if the WI is less than the water capacity
DEFINE FUWIR2 GWIR 'WIST' >= 19000 /   -- if the WI is more than the water capacity
DEFINE FUWATCAP (FUWIR1)*(GWIR 'WIST')+(FUWIR2)*(19000) /

-- UDQ represting initial BHP (only updated once)
DEFINE WUIBP WBP /
UPDATE WUIBP NEXT /
-- UDQs representing BP4 control pressures
DEFINE FUBHPW11 (WUIBP 'W1_1') + ((WWIR 'W1_1')/((WPI4 'W1_1') + 0.001)) + ( 0 ) /
DEFINE FUBHPW12 (WUIBP 'W1_2') + ((WWIR 'W1_2')/((WPI4 'W1_2') + 0.001)) + ( 0 ) /
DEFINE FUBHPW21 (WUIBP 'W2_1') + ((WWIR 'W2_1')/((WPI4 'W2_1') + 0.001)) + ( 0 ) /
DEFINE FUBHPW31 (WUIBP 'W3_1') + ((WWIR 'W3_1')/((WPI4 'W3_1') + 0.001)) + ( 0 ) /
DEFINE FUBHPW41 (WUIBP 'W4_1') + ((WWIR 'W4_1')/((WPI4 'W4_1') + 0.001)) + ( 0 ) /
DEFINE FUBHPW51 (WUIBP 'W5_1') + ((WWIR 'W5_1')/((WPI4 'W5_1') + 0.001)) + ( 0 ) /
DEFINE FUBHPW52 (WUIBP 'W5_2') + ((WWIR 'W5_2')/((WPI4 'W5_2') + 0.001)) + ( 0 ) /
DEFINE FUBHPW61 (WUIBP 'W6_1') + ((WWIR 'W6_1')/((WPI4 'W6_1') + 0.001)) + ( 0 ) /
DEFINE FUBHPW62 (WUIBP 'W6_2') + ((WWIR 'W6_2')/((WPI4 'W6_2') + 0.001)) + ( 0 ) /
DEFINE FUBHPW71 (WUIBP 'W7_1') + ((WWIR 'W7_1')/((WPI4 'W7_1') + 0.001)) + ( 0 ) /
DEFINE FUBHPW81 (WUIBP 'W8_1') + ((WWIR 'W8_1')/((WPI4 'W8_1') + 0.001)) + ( 0 ) /
DEFINE FUBHPW82 (WUIBP 'W8_2') + ((WWIR 'W8_2')/((WPI4 'W8_2') + 0.001)) + ( 0 ) /
DEFINE FUBHPW83 (WUIBP 'W8_3') + ((WWIR 'W8_3')/((WPI4 'W8_3') + 0.001)) + ( 0 ) /
DEFINE FUBHPW91 (WUIBP 'W9_1') + ((WWIR 'W9_1')/((WPI4 'W9_1') + 0.001)) + ( 0 ) /
DEFINE FUBHPW92 (WUIBP 'W9_2') + ((WWIR 'W9_2')/((WPI4 'W9_2') + 0.001)) + ( 0 ) /
DEFINE FUBHPWH1 (WUIBP 'WH_1') + ((WWIR 'WH_1')/((WPI4 'WH_1') + 0.001)) + ( 0 ) /
DEFINE FUBHPWH2 (WUIBP 'WH_2') + ((WWIR 'WH_2')/((WPI4 'WH_2') + 0.001)) + ( 0 ) /
DEFINE FUBHPWH3 (WUIBP 'WH_3') + ((WWIR 'WH_3')/((WPI4 'WH_3') + 0.001)) + ( 0 ) /

-- Fracture pressure
DEFINE FUPFRW11 95.89 + 0.4087*((WBP4 W1_1) - (WUIBP W1_1)) /
DEFINE FUPFRW12 96.99 + 0.4087*((WBP4 W1_2) - (WUIBP W1_2)) /
DEFINE FUPFRW21 90.07 + 0.4087*((WBP4 W2_1) - (WUIBP W2_1)) /
DEFINE FUPFRW31 89.5 + 0.4087*((WBP4 W3_1) - (WUIBP W3_1)) /
DEFINE FUPFRW41 94.25 + 0.4087*((WBP4 W4_1) - (WUIBP W4_1)) /
DEFINE FUPFRW51 96.84 + 0.4087*((WBP4 W5_1) - (WUIBP W5_1)) /
DEFINE FUPFRW52 97.54 + 0.4087*((WBP4 W5_2) - (WUIBP W5_2)) /
DEFINE FUPFRW61 97.49 + 0.4087*((WBP4 W6_1) - (WUIBP W6_1)) /
DEFINE FUPFRW62 94.75 + 0.4087*((WBP4 W6_2) - (WUIBP W6_2)) /
DEFINE FUPFRW71 95.22 + 0.4087*((WBP4 W7_1) - (WUIBP W7_1)) /
DEFINE FUPFRW81 104.19 + 0.4087*((WBP4 W8_1) - (WUIBP W8_1)) /
DEFINE FUPFRW82 96.8 + 0.4087*((WBP4 W8_2) - (WUIBP W8_2)) /
DEFINE FUPFRW83 96.18 + 0.4087*((WBP4 W8_3) - (WUIBP W8_3)) /
DEFINE FUPFRW91 98.86 + 0.4087*((WBP4 W9_1) - (WUIBP W9_1)) /
DEFINE FUPFRW92 97.44 + 0.4087*((WBP4 W9_2) - (WUIBP W9_2)) /
DEFINE FUPFRWH1 89.55 + 0.4087*((WBP4 WH_1) - (WUIBP WH_1)) /
DEFINE FUPFRWH2 96.69 + 0.4087*((WBP4 WH_2) - (WUIBP WH_2)) /
DEFINE FUPFRWH3 96.41 + 0.4087*((WBP4 WH_3) - (WUIBP WH_3)) /

-- Margin to fracking pressure
DEFINE FUFPMW11 97.21 - FUPFRW11 /
DEFINE FUFPMW12 101.89 - FUPFRW12 /
DEFINE FUFPMW21 89.25 - FUPFRW21 /
DEFINE FUFPMW31 89.9 - FUPFRW31 /
DEFINE FUFPMW41 98.44 - FUPFRW41 /
DEFINE FUFPMW51 97.33 - FUPFRW51 /
DEFINE FUFPMW52 98.58 - FUPFRW52 /
DEFINE FUFPMW61 95.06 - FUPFRW61 /
DEFINE FUFPMW62 93.52 - FUPFRW62 /
DEFINE FUFPMW71 94.42 - FUPFRW71 /
DEFINE FUFPMW81 111.16 - FUPFRW81 /
DEFINE FUFPMW82 99.21 - FUPFRW82 /
DEFINE FUFPMW83 94.28 - FUPFRW83 /
DEFINE FUFPMW91 101.59 - FUPFRW91 /
DEFINE FUFPMW92 98.88 - FUPFRW92 /
DEFINE FUFPMWH1 94.96 - FUPFRWH1 /
DEFINE FUFPMWH2 101.43 - FUPFRWH2 /
DEFINE FUFPMWH3 100.88 - FUPFRWH3 /

-- UDQs related to matrix injection calculations
ASSIGN WUWWIT 0  /
DEFINE FU_CW FUPWFR*5 + (1-FUPWFR)*15 /
DEFINE WUCUMTS  WWIT-WUWWIT / -- Cum inj since last update
ASSIGN FU_A	0.010044148673  /
ASSIGN FU_B	0.031299095472  /
ASSIGN FU_C	0.434074197176  /
ASSIGN FU_D	-0.187415456471 /

ASSIGN WUDCLCUM  300000 /
DEFINE WUDCLFAC EXP(1-(FU_A*LN(FU_CW)+FU_B)*(WUCUMTS+WUDCLCUM)^(FU_C*FU_CW^FU_D)) /
UPDATE WUDCLFAC NEXT /
DEFINE WUWWIT WWIT /
UPDATE WUWWIT NEXT /
/

TSTEP
0.1 /

UDQ
DEFINE 'WUDEPL'    WBP4 - WUIBP /
DEFINE 'WUDCLCUM' ((1-LN(WUDCLFAC))/(FU_A*LN(FU_CW)+FU_B))^(1/(FU_C*FU_CW^FU_D))  /

-- Max matrix rate per well (BHP-Pr)*Injectivity decline factor*Initial injectivity
DEFINE FUMMRW11 (97.21-(WBP4 W1_1))*(WUDCLFAC W1_1)*84.61143*(253.0^0.406993598137659)*(412805.47/253.0)/2600 /
DEFINE FUMMRW12 (101.89-(WBP4 W1_2))*(WUDCLFAC W1_2)*84.61143*(906.0^0.406993598137659)*(1794855.24/906.0)/2600 /
DEFINE FUMMRW21 (89.25-(WBP4 W2_1))*(WUDCLFAC W2_1)*84.61143*(300.0^0.406993598137659)*(528109.21/300.0)/2600 /
DEFINE FUMMRW31 (89.9-(WBP4 W3_1))*(WUDCLFAC W3_1)*84.61143*(300.0^0.406993598137659)*(579768.33/300.0)/2600 /
DEFINE FUMMRW41 (98.44-(WBP4 W4_1))*(WUDCLFAC W4_1)*84.61143*(305.0^0.406993598137659)*(572823.45/305.0)/2600 /
DEFINE FUMMRW51 (97.33-(WBP4 W5_1))*(WUDCLFAC W5_1)*84.61143*(282.0^0.406993598137659)*(8210.22/282.0)/2600 /
DEFINE FUMMRW52 (98.58-(WBP4 W5_2))*(WUDCLFAC W5_2)*84.61143*(307.5^0.406993598137659)*(692328.36/307.5)/2600 /
DEFINE FUMMRW61 (95.06-(WBP4 W6_1))*(WUDCLFAC W6_1)*84.61143*(203.0^0.406993598137659)*(10303.64/203.0)/2600 /
DEFINE FUMMRW62 (93.52-(WBP4 W6_2))*(WUDCLFAC W6_2)*84.61143*(220.0^0.406993598137659)*(112079.07/220.0)/2600 /
DEFINE FUMMRW71 (94.42-(WBP4 W7_1))*(WUDCLFAC W7_1)*84.61143*(300.0^0.406993598137659)*(1043248.76/300.0)/2600 /
DEFINE FUMMRW81 (111.16-(WBP4 W8_1))*(WUDCLFAC W8_1)*84.61143*(300.5^0.406993598137659)*(232252.36/300.5)/2600 /
DEFINE FUMMRW82 (99.21-(WBP4 W8_2))*(WUDCLFAC W8_2)*84.61143*(282.5^0.406993598137659)*(523948.59/282.5)/2600 /
DEFINE FUMMRW83 (94.28-(WBP4 W8_3))*(WUDCLFAC W8_3)*84.61143*(200.0^0.406993598137659)*(87357.5/200.0)/2600 /
DEFINE FUMMRW91 (101.59-(WBP4 W9_1))*(WUDCLFAC W9_1)*84.61143*(350.0^0.406993598137659)*(677982.54/350.0)/2600 /
DEFINE FUMMRW92 (98.88-(WBP4 W9_2))*(WUDCLFAC W9_2)*84.61143*(180.0^0.406993598137659)*(583145.62/180.0)/2600 /
DEFINE FUMMRWH1 (94.96-(WBP4 WH_1))*(WUDCLFAC WH_1)*84.61143*(276.0^0.406993598137659)*(645998.97/276.0)/2600 /
DEFINE FUMMRWH2 (101.43-(WBP4 WH_2))*(WUDCLFAC WH_2)*84.61143*(313.0^0.406993598137659)*(550895.06/313.0)/2600 /
DEFINE FUMMRWH3 (100.88-(WBP4 WH_3))*(WUDCLFAC WH_3)*84.61143*(300.0^0.406993598137659)*(1332077.15/300.0)/2600 /

-- Max fracture rate per well
DEFINE FUMFRW11 (FUFPMW11>0)*((97.21-FUPFRW11)*255+(FUPFRW11-(WBP4 W1_1))*48)+(FUFPMW11<=0)*(97.21-(WBP4 W1_1))*48/
DEFINE FUMFRW12 (FUFPMW12>0)*((101.89-FUPFRW12)*255+(FUPFRW12-(WBP4 W1_2))*48)+(FUFPMW12<=0)*(101.89-(WBP4 W1_2))*48/
DEFINE FUMFRW21 (FUFPMW21>0)*((89.25-FUPFRW21)*255+(FUPFRW21-(WBP4 W2_1))*48)+(FUFPMW21<=0)*(89.25-(WBP4 W2_1))*48/
DEFINE FUMFRW31 (FUFPMW31>0)*((89.9-FUPFRW31)*255+(FUPFRW31-(WBP4 W3_1))*48)+(FUFPMW31<=0)*(89.9-(WBP4 W3_1))*48/
DEFINE FUMFRW41 (FUFPMW41>0)*((98.44-FUPFRW41)*255+(FUPFRW41-(WBP4 W4_1))*48)+(FUFPMW41<=0)*(98.44-(WBP4 W4_1))*48/
DEFINE FUMFRW51 (FUFPMW51>0)*((97.33-FUPFRW51)*255+(FUPFRW51-(WBP4 W5_1))*48)+(FUFPMW51<=0)*(97.33-(WBP4 W5_1))*48/
DEFINE FUMFRW52 (FUFPMW52>0)*((98.58-FUPFRW52)*255+(FUPFRW52-(WBP4 W5_2))*48)+(FUFPMW52<=0)*(98.58-(WBP4 W5_2))*48/
DEFINE FUMFRW61 (FUFPMW61>0)*((95.06-FUPFRW61)*255+(FUPFRW61-(WBP4 W6_1))*48)+(FUFPMW61<=0)*(95.06-(WBP4 W6_1))*48/
DEFINE FUMFRW62 (FUFPMW62>0)*((93.52-FUPFRW62)*255+(FUPFRW62-(WBP4 W6_2))*48)+(FUFPMW62<=0)*(93.52-(WBP4 W6_2))*48/
DEFINE FUMFRW71 (FUFPMW71>0)*((94.42-FUPFRW71)*255+(FUPFRW71-(WBP4 W7_1))*48)+(FUFPMW71<=0)*(94.42-(WBP4 W7_1))*48/
DEFINE FUMFRW81 (FUFPMW81>0)*((111.16-FUPFRW81)*255+(FUPFRW81-(WBP4 W8_1))*48)+(FUFPMW81<=0)*(111.16-(WBP4 W8_1))*48/
DEFINE FUMFRW82 (FUFPMW82>0)*((99.21-FUPFRW82)*255+(FUPFRW82-(WBP4 W8_2))*48)+(FUFPMW82<=0)*(99.21-(WBP4 W8_2))*48/
DEFINE FUMFRW83 (FUFPMW83>0)*((94.28-FUPFRW83)*255+(FUPFRW83-(WBP4 W8_3))*48)+(FUFPMW83<=0)*(94.28-(WBP4 W8_3))*48/
DEFINE FUMFRW91 (FUFPMW91>0)*((101.59-FUPFRW91)*255+(FUPFRW91-(WBP4 W9_1))*48)+(FUFPMW91<=0)*(101.59-(WBP4 W9_1))*48/
DEFINE FUMFRW92 (FUFPMW92>0)*((98.88-FUPFRW92)*255+(FUPFRW92-(WBP4 W9_2))*48)+(FUFPMW92<=0)*(98.88-(WBP4 W9_2))*48/
DEFINE FUMFRWH1 (FUFPMWH1>0)*((94.96-FUPFRWH1)*255+(FUPFRWH1-(WBP4 WH_1))*48)+(FUFPMWH1<=0)*(94.96-(WBP4 WH_1))*48/
DEFINE FUMFRWH2 (FUFPMWH2>0)*((101.43-FUPFRWH2)*255+(FUPFRWH2-(WBP4 WH_2))*48)+(FUFPMWH2<=0)*(101.43-(WBP4 WH_2))*48/
DEFINE FUMFRWH3 (FUFPMWH3>0)*((100.88-FUPFRWH3)*255+(FUPFRWH3-(WBP4 WH_3))*48)+(FUFPMWH3<=0)*(100.88-(WBP4 WH_3))*48/

/

GCONPROD
WIST ORAT 24000 FUWATCAP 1700000 33000 RATE NO 1* FORM /
-- WIST ORAT <OILCAPACITY> <WATCAPACITY> <GASCAPACITY> <LIQCAPACITY> RATE NO 1* FORM /
/

WCONPROD
  P1_1  SHUT GRUP 3000 1* 400000 2* 30 12 1 /
  P1_2  SHUT GRUP 3000 1* 400000 2* 30 12 1 /
  P2_1  SHUT GRUP 3000 1* 400000 2* 30 12 1 /
  P3_1  SHUT GRUP 3000 1* 400000 2* 30 12 1 /
  P3_2  SHUT GRUP 3000 1* 400000 2* 30 12 1 /
  P4_1  SHUT GRUP 3000 1* 400000 2* 30 12 1 /
  P4_2  SHUT GRUP 3000 1* 400000 2* 30 12 1 /
  P5_1  SHUT GRUP 3000 1* 400000 2* 30 12 1 /
  P5_2  SHUT GRUP 3000 1* 400000 2* 30 12 1 /
  P6_1  SHUT GRUP 3000 1* 400000 2* 30 12 1 /
  P6_2  SHUT GRUP 3000 1* 400000 2* 30 12 1 /
  P8_1  SHUT GRUP 3000 1* 400000 2* 30 12 1 /
  P8_2  SHUT GRUP 3000 1* 400000 2* 30 12 1 /
  P8_3  SHUT GRUP 3000 1* 400000 2* 30 12 1 /
  P7_1  SHUT GRUP 3000 1* 400000 2* 30 12 1 /
  P9_1  SHUT GRUP 3000 1* 400000 2* 30 12 1 /
  P9_2  SHUT GRUP 3000 1* 400000 2* 30 12 1 /
  PH_1  SHUT GRUP 3000 1* 400000 2* 30 12 1 /
  PH_2  SHUT GRUP 3000 1* 400000 2* 30 12 1 /
  PH_3  SHUT GRUP 3000 1* 400000 2* 30 12 1 /
/

WECON
 'P*' 50 1* 0.99 2* WELL 2* RATE /
/

GCONINJE
WIST WATER RATE FUWAT /
/

WCONINJE
--well   phase  op/sh  ctrl   rate       -  bhp        thp   vfp
  W1_1   WATER  SHUT   BHP    FUMMRW11  1* FUBHPW11   1*    2   /
  W1_2   WATER  SHUT   BHP    FUMMRW12  1* FUBHPW12   1*    2   /
  W2_1   WATER  SHUT   BHP    FUMMRW21  1* FUBHPW21   1*    2   /
  W3_1   WATER  SHUT   BHP    FUMMRW31  1* FUBHPW31   1*    2   /
  W4_1   WATER  SHUT   BHP    FUMMRW41  1* FUBHPW41   1*    2   /
  W5_1   WATER  SHUT   BHP    FUMMRW51  1* FUBHPW51   1*    2   /
  W5_2   WATER  SHUT   BHP    FUMMRW52  1* FUBHPW52   1*    2   /
  W6_1   WATER  SHUT   BHP    FUMMRW61  1* FUBHPW61   1*    2   /
  W6_2   WATER  SHUT   BHP    FUMMRW62  1* FUBHPW62   1*    2   /
  W7_1   WATER  SHUT   BHP    FUMMRW71  1* FUBHPW71   1*    2   /
  W8_1   WATER  SHUT   BHP    FUMMRW81  1* FUBHPW81   1*    2   /
  W8_2   WATER  SHUT   BHP    FUMMRW82  1* FUBHPW82   1*    2   /
  W8_3   WATER  SHUT   BHP    FUMMRW83  1* FUBHPW83   1*    2   /
  W9_1   WATER  SHUT   BHP    FUMMRW91  1* FUBHPW91   1*    2   /
  W9_2   WATER  SHUT   BHP    FUMMRW92  1* FUBHPW92   1*    2   /
  WH_1   WATER  SHUT   BHP    FUMMRWH1  1* FUBHPWH1   1*    2   /
  WH_2   WATER  SHUT   BHP    FUMMRWH2  1* FUBHPWH2   1*    2   /
  WH_3   WATER  SHUT   BHP    FUMMRWH3  1* FUBHPWH3   1*    2   /
/

WEFAC
'W*' 0.98 /
/

GUIDERAT
1* OIL 1.0 1.0 2.0 1.0 3.0 /
